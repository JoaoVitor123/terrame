include(GetPrerequisites)
get_prerequisites(@MY_BINARY_LOCATION@ DEPENDENCIES_TME 0 1 "" "")
# message("Dependencies: @CMAKE_INSTALL_NAME_TOOL@")

foreach(DEPENDENCY ${DEPENDENCIES_TME})
    get_filename_component(DEPENDENCY_NAME "${DEPENDENCY}" NAME)
    get_filename_component(DEPENDENCY_ACTUAL "${DEPENDENCY}" REALPATH)
    # message("Dependencies: ${DEPENDENCY_ACTUAL}")

    file(INSTALL
         DESTINATION "${CMAKE_INSTALL_PREFIX}/lib"
         TYPE EXECUTABLE
         FILES "${DEPENDENCY_ACTUAL}"
    )

    # add_custom_command(OUTPUT ${DEPENDENCY_NAME}
    #     COMMAND @CMAKE_INSTALL_NAME_TOOL@;-id;@executable_path/../lib/${DEPENDENCY_NAME};${DEPENDENCY_ACTUAL}
    # )

    # add_custom_command(TARGET TerraME 
    #     POST_BUILD COMMAND 
    #     @CMAKE_INSTALL_NAME_TOOL@ -change "${DEPENDENCY_ACTUAL}" "@executable_path/../lib/${DEPENDENCY_NAME}"
    #     $<TARGET_FILE:TerraME>
    # )
endforeach()
